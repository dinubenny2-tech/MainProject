<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Request</title>
</head>

<body>
    <form method="post">
        {% csrf_token %}

        <h2 align="center">My Requests</h2>

        <table align="center" border="1" cellpadding="8">
            <tr>
                <th>SINO</th>
                <th>Details</th>
                <th>Todate</th>
                <th>Service Centre Details</th>
                <th>Worker Details</th>
                <th>Action</th>
            </tr>

            {% for i in sc %}
            <tr>
                <td>{{ forloop.counter }}</td>

                <td>{{ i.request_details }}</td>

                <td>{{ i.request_todate|default:"-" }}</td>

                <td>
                    {% if i.servicecentre %}
                    {{ i.servicecentre.servicecentre_name }}<br>
                    {{ i.servicecentre.servicecentre_email }}<br>
                    {{ i.servicecentre.servicecentre_contact }}
                    {% else %}
                    <b style="color:red;">Service Centre Not Assigned</b>
                    {% endif %}
                </td>

                <td>
                    {% if i.worker %}
                    {{ i.worker.worker_name }}<br>
                    {{ i.worker.worker_email }}<br>
                    {{ i.worker.worker_contact }}
                    {% else %}
                    <b style="color:red;">Worker Not Assigned</b>
                    {% endif %}
                </td>

                <td>

                    {% if i.request_status == 0 %}
                    Request Submitted

                    {% elif i.request_status == 1 %}
                    Request Accepted By Admin

                    {% elif i.request_status == 2 %}
                    <span style="color:red;">Request Rejected By Admin</span>

                    {% elif i.request_status == 3 %}
                    Assigned to Service Centre

                    {% elif i.request_status == 4 %}
                    Worker Assigned |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 5 %}
                    Upload File For Replacement |
                    <a href="{% url 'User:upload' i.id %}">Upload</a> |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 6 %}
                    File Uploaded |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 7 %}
                    Replacement Completed |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>
                    <br>
                    {% for r in i.tbl_replacement_set.all %}
                    {% if r.replacement_pdf %}
                    <a href="{{ r.replacement_pdf.url }}" target="_blank">
                        Download Replacement PDF
                    </a>
                    {% endif %}
                    {% empty %}
                    File Not Available
                    {% endfor %}

                    {% elif i.request_status == 9 %}
                    Repair Selected |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 10 %}
                    Worker Will Visit Soon |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 11 %}
                    <span class="cancelled">Cancelled Due Safety Issues..</span>
                    {% elif i.request_status == 12 %}
                    Work Ready To Start |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 13 %}
                    Work In Progress |
                    <a href="{% url 'User:chatpage' i.worker.id %}">Chat</a>

                    {% elif i.request_status == 14 %}
                    <span class="done">Completed</span> |
                    <a href="{% url 'User:rating' i.worker.id %}">Rate Worker</a>

                    {% elif i.request_status == 16 %}
                    <span style="color:red; font-weight:bold;">
                        Worker Cancelled â€“ Reassigning New Worker
                    </span>

                    {% else %}
                    Pending

                    {% endif %}

                </td>


            </tr>
            {% empty %}
            <tr>
                <td colspan="6" align="center">No Requests Found</td>
            </tr>
            {% endfor %}
        </table>
    </form>
</body>

</html>